# .gitlab-ci.yml
# This file is read by GitLab automatically on every git push.
# It defines your CI/CD pipeline.

stages:          # defines the ordered list of stages in the pipeline
  - lint         # stage 1: check code style
  - test         # stage 2: run tests (only runs if lint passes)

run-lint:                   # name of this job
  stage: lint               # this job runs in the "lint" stage
  image: python:3.11-slim   # same Docker image with Python
  script:
    - pip install flake8     # flake8 is a code style checker
    - flake8 calculator.py --max-line-length=100
    # ↑ checks calculator.py for style issues (unused imports, bad formatting, etc.)
    # --max-line-length=100 allows lines up to 100 characters (default is 79)

run-tests:                  # name of this job — you can call it anything
  stage: test               # this job runs in the "test" stage
  image: python:3.11-slim   # GitLab pulls this Docker image and runs commands inside it
                            # "slim" = smaller image, faster startup
  script:                   # list of shell commands to run, in order
    - pip install pytest     # install the pytest library (not pre-installed in the image)
    - pytest test_calculator.py -v
    # ↑ -v = verbose: shows each test name and whether it passed or failed
